# 🚀 수업 복습
복습 내용 : 도커 컴포즈, 쿠버네티스
## docker compose
- 여러 컨테이너로 구성된 애플리케이션을 정의하고 공유하기 위해 개발된도구
- yaml 파일을 통해 서비스를 정의하고 단일 명령어로 모든 서비스를 생성하거나 중지할 수 있음

| 단어  | 설명 |
| --- | --- |
| **dockerfile** | 하나의 컨테이너 이미지를 빌드하는 단계를 기술한 파일 |
| **docker-compose** | 한 개 이상의 컨테이너를 규정하고 run 하는 내용을 기재한 `docker-compose.yml` 파일을 실행/중지/제거 하는 도구 |

### 명령어 모음

#### `docker-compose up -d`

- `docker-compose.yml` 파일을 기반으로 서비스를 백그라운드에서 실행.
- `-d` : 컨테이너를 백드라운드 모드로 실행. 실행 중인 컨테이너의 로그를 터미널에 표시하지 않음
- `docker-compose --build` : 컨테이너를 실행하기 전에 이미지를 새로 빌드

#### `docker-compose stop`

- 실행 중인 서비스의 컨테이너를 중지. 컨테이너 자체는 삭제되지 않음. 필요할 때 다시 시작할 수 있음.
    - → `docker-compose restart`

#### `docker-compose down`

- 실행 중인 서비스의 컨테이너를 중지하고 관련된 네트워크 및 볼륨도 제거.
- docker-compose.yml 파일을 기반으로 정의된 모든 서비스를 중지하고 컨테이너들을 제거
- `docker-compose down --volumes`
    - `--volumes` 옵션 : 관련된 모든 볼륨도 함께 제거된다.
- 다시 시작하려면 dockero-compose up (모든 리소스 다시 생성)

#### `docker-compose restart`

- `docker compose`를 사용해 실행 중인 서비스의 컨테이너를 재시작하는 명령어. 모든 서비스의 컨테이너를 중지하고 다시 시작함
- `docker-compose restart [service_name]`
    - 만약 `[service_name]`을 지정하지 않으면 `docker-compose.yml` 파일에 정의된 모든 서비스의 컨테이너가 재시작됨.
 
## 쿠버네티스
**Kubernetes : 컨테이너 오케스트레이션을 위한 오픈소스 플랫폼.**

> **K**ubernete**s (K8s)**
> 

→ 쿠버네티스, 케잇츠, 쿠베, 큐브 라고도 불린다!

## 쿠버네티스의 구성 요소

![image](https://github.com/user-attachments/assets/6f98513c-ef7b-4f5f-b1b7-321346b84242)

### 컨트롤 플레인 (Master Node)

![image](https://github.com/user-attachments/assets/514e269a-dcce-4280-8e80-287b229a2b8e)

1. **API Server**
- 컨트롤 플레인의 프론트엔드 역할
- 조회나 요청은 모두 API Server를 통해 이루어짐
- etcd와 직접 통신하는 유일한 모듈

2. **Controller Manager**
- 다양한 컨트롤러 프로세스를 실행
- 논리적으로 다양한 컨트롤러가 존재한다 (복제 컨트롤러, 노드 컨트롤러, 엔드포인트 컨트롤러 …)
- 클러스터 상태를 지속적으로 점검하며 원하는 상태를 유지

3. **Scheduler**
- 배정되지 않은 새로 생성된 파드 감지하고 실행할 노드를 선택

4. **etcd**
- 모든 클러스터 데이터를 담는 쿠버네티스 뒷단의 저장소
- 고가용성 : 분산 시스템으로 구성해 안전성을 높임
- 일관성 : 가볍고 빠르면서 정확하게 설계
- Key-Value 형태로 데이터 저장

### 워커 노드(Worker Node)

- **노드 (Node)  ≈  컴퓨터**
- 쿠버네티스에서 **워커 머신**을 말함
- 컨테이너를 실행하는 **물리 서버** 또는 **가상 머신**
- 노드는 그냥 컨테이너가 돌아가는 **컴퓨터**인 셈! (EC2 인스턴스)

![image](https://github.com/user-attachments/assets/5b514465-11e2-4500-a934-8f7a3a71c7c5)

1. **kubelet**
- 각 노드에서 실행
- Pod를 실행/중지하고 상태를 체크

2. **kube-proxy**
- 클러스터의 각 노드에서 실행되는 네트워크 프록시
- 노드의 네트워크 규칙을 유지 관리
- 서비스의 클러스터 IP와 포트를 외부 클라이언트가 접근할 수 있도록 함

3. **Pod**
- 쿠버네티스에서 생성, 관리, 배포되는 최소 단위

### Pod

> **쿠버네티스에서 생성되고, 스케줄링되며, 관리되고, 배포되는 최소 단위**


- 하나 이상의 컨테이너로 구성될 수 있지만 일반적으로 한 어플리케이션 컨테이너를 포함
- 파드는 언제나 **노드** 상에서 동작
- 동일한 파드 내의 컨테이너들은 `network namespace`를 공유하며 `localhost`로 통신
- 파드 내 컨테이너들은 함께 생성, 배치, 종료됨. 하나의 컨테이너가 망가지면 전체 파드가 종료되고 다시 스케줄링됨.
- 각 파드는 고유한 내부 IP를 가지며 재생성될 때마다 새로운 IP를 받음
- 유사한 요구사항 또는 의존성을 가진 컨테이너들만 한 pod 에 넣는 것이 권장됨
